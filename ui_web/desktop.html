<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <base href="/player/">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="theme-color" id="meta-theme-color" content="#0d0d0f">
    <title>Soundsible Desktop</title>
    <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192.png">
    <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png">
    <link rel="manifest" href="manifest-desktop.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        :root {
            color-scheme: dark;
            --bg-deep: #0d0d0f;
            --bg-surface: rgba(30, 31, 34, 0.85);
            --bg-card: #1e1f22;
            --bg-selection: #4a2a0a;
            --accent: #f97a12;
            --secondary: #3178c6;
            --text-main: #dfe1e5;
            --text-dim: #808080;
            --glass-border: rgba(255, 255, 255, 0.08);
            --radius-omni: 28px;
            --radius-omni-sm: 20px;
            --radius-omni-xs: 14px;
            --shadow-omni: 0 20px 50px rgba(0, 0, 0, 0.5);
            --input-bg: rgba(0, 0, 0, 0.4);
            --input-border: rgba(255, 255, 255, 0.1);
            --overlay-bg: rgba(0, 0, 0, 0.8);
            --text-on-accent: #ffffff;
            --surface-overlay: rgba(255, 255, 255, 0.05);
            --seek-track: rgba(255, 255, 255, 0.1);
        }
        [data-theme="light"] {
            color-scheme: light;
            --bg-deep: #f5f5f5;
            --bg-surface: rgba(255, 255, 255, 0.85);
            --bg-card: #ffffff;
            --bg-selection: #deeaff;
            --accent: #3178c6;
            --secondary: #f97a12;
            --text-main: #1c1c1c;
            --text-dim: #606060;
            --glass-border: rgba(0, 0, 0, 0.08);
            --input-bg: rgba(0, 0, 0, 0.06);
            --input-border: rgba(0, 0, 0, 0.12);
            --overlay-bg: rgba(0, 0, 0, 0.5);
            --surface-overlay: rgba(0, 0, 0, 0.05);
            --seek-track: rgba(0, 0, 0, 0.12);
        }
        [data-theme="odst"] {
            color-scheme: dark;
            /* Content (e.g. under "Library") = card/surface; background = slightly darker + very subtle gradient to ODST orange */
            --bg-deep: #1c2026;
            --bg-deep-mid: #1d1f24;
            --bg-deep-end: #1e1f21;
            --bg-surface: rgba(32, 34, 42, 0.94);
            --bg-card: #242830;
            --bg-selection: rgba(201, 162, 39, 0.15);
            --accent: #c9a227;
            --secondary: #a88b3a;
            --text-main: #e8e6e3;
            --text-dim: #9a968f;
            --glass-border: rgba(255, 255, 255, 0.06);
            --radius-omni: 28px;
            --radius-omni-sm: 20px;
            --radius-omni-xs: 14px;
            --shadow-omni: 0 12px 32px rgba(0, 0, 0, 0.25);
            --input-bg: rgba(0, 0, 0, 0.25);
            --input-border: rgba(255, 255, 255, 0.06);
            --overlay-bg: rgba(28, 32, 38, 0.92);
            --text-on-accent: #1a1e28;
            --surface-overlay: rgba(255, 255, 255, 0.04);
            --seek-track: rgba(255, 255, 255, 0.08);
        }
        html[data-theme="odst"],
        html[data-theme="odst"] body {
            background: linear-gradient(to bottom, var(--bg-deep) 0%, var(--bg-deep-mid) 55%, var(--bg-deep-end) 100%);
            background-attachment: fixed;
        }
        html[data-theme="odst"] #initial-loader.initial-loader-bg,
        html[data-theme="odst"] .initial-loader-bg#initial-loader {
            background: linear-gradient(to bottom, var(--bg-deep) 0%, var(--bg-deep-mid) 55%, var(--bg-deep-end) 100%) !important;
        }
        #initial-loader.initial-loader-bg,
        .initial-loader-bg#initial-loader {
            background-color: var(--bg-deep);
        }
        html, body { background-color: var(--bg-deep); color: var(--text-main); font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; height: 100%; overflow: hidden; }
        .glass-view { background: var(--bg-surface); backdrop-filter: blur(32px); -webkit-backdrop-filter: blur(32px); border: 1px solid var(--glass-border); }
        .input-theme { background: var(--input-bg); border: 1px solid var(--input-border); color: var(--text-main); }
        select.input-theme {
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23dfe1e5' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }
        [data-theme="light"] select.input-theme {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%231c1c1c' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
        }
        [data-theme="odst"] select.input-theme {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23e8e6e3' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
        }
        select.input-theme option {
            background: var(--bg-card);
            color: var(--text-main);
        }
        #desktop-app { display: flex; flex-direction: column; height: 100vh; }
        #desktop-body { display: flex; flex-direction: column; flex: 1; min-height: 0; position: relative; }
        #desktop-now-playing { --desktop-np-bar-height: 64px; --desktop-np-bar-padding-y: 0.375rem; min-height: var(--desktop-np-bar-height); flex-shrink: 0; border-bottom: 1px solid var(--glass-border); background: var(--bg-surface); backdrop-filter: blur(24px); display: grid; grid-template-columns: 1fr auto 1fr; grid-template-rows: auto auto; align-items: center; gap: 0 1rem; row-gap: 0.25rem; padding: var(--desktop-np-bar-padding-y) 1rem; }
        #desktop-body-row { display: flex; flex: 1; min-height: 0; }
        #desktop-sidebar { width: 240px; flex-shrink: 0; padding: 1rem; border-right: 1px solid var(--glass-border); display: flex; flex-direction: column; gap: 0.5rem; }
        #desktop-main { flex: 1; overflow: auto; padding: 1.5rem; position: relative; background-color: var(--bg-deep); }
        
        /* Desktop Global Search */
        #desktop-global-search-container {
            position: sticky;
            top: -1.5rem; /* account for main padding */
            z-index: 100;
            margin: 0 -1.5rem 1.5rem -1.5rem;
            padding: 1.5rem;
            background: linear-gradient(to bottom, var(--bg-deep) 60%, transparent);
            transition: box-shadow 0.3s ease;
        }

        #desktop-global-search-container.scrolled {
            background: var(--bg-deep);
            border-bottom: 1px solid var(--bg-deep);
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }

        .desktop-global-search-inner {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--input-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-omni-xs);
            padding: 8px 16px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .desktop-global-search-inner:focus-within {
            border-color: var(--accent);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 2px rgba(249, 122, 18, 0.2);
        }

        #desktop-global-search-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-main);
            font-size: 14px;
            font-weight: 500;
            padding: 8px 0;
        }

        #desktop-global-search-input::placeholder {
            color: var(--placeholder);
        }

        #desktop-global-search-container .desktop-discover-odst-inline { display: none; }
        #desktop-global-search-container.show-discover-odst .desktop-discover-odst-inline { display: flex; }

        .desktop-view { display: none; }
        .desktop-view.active { display: block; }
        #desktop-view-playlists:not(.active) { display: none !important; }
        #desktop-view-discover.active { min-height: 100%; display: flex; flex-direction: column; }
        #desktop-view-discover.active > div { flex: 1; min-height: 0; }
        #desktop-now-playing .desktop-queue-status-btn:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
        #desktop-sidebar .desktop-queue-status-btn.queue-panel-open { background: var(--surface-overlay); color: var(--text-main); }
        #desktop-queue-count.queue-has-items { color: var(--accent); opacity: 1; }
        .desktop-nav-btn { width: 100%; text-align: left; padding: 0.6rem 0.75rem; border-radius: var(--radius-omni-xs); color: var(--text-dim); font-weight: 600; font-size: 0.875rem; border: none; background: transparent; cursor: pointer; transition: background 0.2s, color 0.2s; }
        .desktop-nav-btn:hover { background: var(--surface-overlay); color: var(--text-main); }
        .desktop-nav-btn.active { background: var(--bg-selection); color: var(--accent); }
        .song-row { transition: background-color 0.2s; }
        /* Search view: positioning context for ODST toggle (one button height from bottom) */
        /* Desktop: no mobile swipe/long-press; hide swipe hints so Favourite/Queue labels never show */
        .swipe-hints { opacity: 0 !important; visibility: hidden; pointer-events: none; }
        #desktop-main .song-row { transform: none !important; }
        #desktop-now-playing button:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
        #desktop-now-playing #desktop-volume:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
        /* Volume bubble: same size as shuffle/repeat when collapsed; expands on hover to the left (icon stays on right). */
        .desktop-volume-bubble-wrap {
            width: 120px;
            min-width: 120px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            position: relative;
        }
        #desktop-volume-bubble {
            width: 32px;
            min-width: 32px;
            height: 32px;
            min-height: 32px;
            overflow: hidden;
            border-radius: 9999px;
            transition: width 333ms cubic-bezier(0.19, 1, 0.22, 1);
            transform: translateZ(0);
            gap: 0;
            justify-content: center;
        }
        .desktop-volume-bubble-wrap:hover #desktop-volume-bubble {
            width: 100px;
            gap: 0.5rem;
            justify-content: flex-end;
        }
        /* Volume handle: invisible by default; fades in over 333ms when bubble expands; fades out over 323ms on close (invisible 0.01s before bubble fully contracted). */
        #desktop-volume::-webkit-slider-thumb {
            opacity: 0;
            transition: opacity 323ms cubic-bezier(0.19, 1, 0.22, 1);
        }
        .desktop-volume-bubble-wrap:hover #desktop-volume::-webkit-slider-thumb {
            opacity: 1;
            transition: opacity 333ms cubic-bezier(0.19, 1, 0.22, 1);
        }
        #desktop-volume::-moz-range-thumb {
            opacity: 0;
            transition: opacity 323ms cubic-bezier(0.19, 1, 0.22, 1);
        }
        .desktop-volume-bubble-wrap:hover #desktop-volume::-moz-range-thumb {
            opacity: 1;
            transition: opacity 333ms cubic-bezier(0.19, 1, 0.22, 1);
        }
        @media (prefers-reduced-motion: reduce) {
            #desktop-volume-bubble { transition-duration: 0.05s; }
            #desktop-volume::-webkit-slider-thumb,
            .desktop-volume-bubble-wrap:hover #desktop-volume::-webkit-slider-thumb,
            #desktop-volume::-moz-range-thumb,
            .desktop-volume-bubble-wrap:hover #desktop-volume::-moz-range-thumb { transition-duration: 0.05s; }
        }
        #desktop-sidebar .desktop-nav-btn:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
        #desktop-sidebar-playback button:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
        /* Desktop logo-omnibar: circle (seed) / pill (expanded), same look as mobile omni-seed. */
        #desktop-logo-omni {
            height: 56px;
            min-height: 56px;
            border-radius: var(--radius-omni);
            box-shadow: 0 0 28px rgba(0, 0, 0, 0.45);
            transition: width 333ms cubic-bezier(0.19, 1, 0.22, 1);
            transform: translateZ(0);
            isolation: isolate;
        }
        [data-theme="light"] #desktop-logo-omni { box-shadow: 0 0 24px rgba(0, 0, 0, 0.2); }
        [data-theme="odst"] #desktop-logo-omni { box-shadow: 0 0 20px rgba(0, 0, 0, 0.3); }
        #desktop-logo-omni.logo-omni-seed { width: 56px; }
        #desktop-logo-omni:not(.logo-omni-seed) { width: 250px; }
        /* Desktop playback controls: centered in status bar. */
        #desktop-omni-island {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            height: 48px;
            min-height: 48px;
            padding: 0 12px;
            border-radius: var(--radius-omni);
            box-shadow: var(--shadow-omni);
        }
        #desktop-now-playing .desktop-np-timebar-row { grid-column: 1 / -1; display: flex; align-items: center; gap: 0.25rem; min-width: 0; max-height: 0; overflow: hidden; opacity: 0; visibility: hidden; transition: max-height 0.25s ease-out, opacity 0.2s ease-out; }
        #desktop-now-playing.has-track .desktop-np-timebar-row { max-height: 2.5rem; opacity: 1; visibility: visible; }
        #desktop-now-playing .desktop-np-timebar-row #desktop-np-seek { flex: 1; min-width: 0; }
        #desktop-now-playing .desktop-np-timebar-row .desktop-np-time-label { min-width: 2.5rem; width: 2.5rem; flex-shrink: 0; transform: translateY(2px); }
        #desktop-now-playing:not(.has-track) .desktop-np-timebar-row .desktop-np-time-label { visibility: hidden; }
        #desktop-now-playing:not(.has-track) .desktop-np-cover-wrap { display: none; }
        #desktop-now-playing .desktop-np-left { display: flex; align-items: center; gap: 1rem; min-width: 0; }
        #desktop-now-playing .desktop-np-cover-wrap { width: 3.5rem; min-width: 3.5rem; flex-shrink: 0; }
        #desktop-now-playing .desktop-np-center { flex: 1; min-width: 0; }
        #desktop-now-playing .desktop-np-playback-cell { display: flex; justify-content: center; align-items: center; }
        #desktop-omni-island .desktop-omni-btn-side {
            width: 32px;
            height: 32px;
            min-width: 32px;
            min-height: 32px;
            flex-shrink: 0;
        }
        #desktop-omni-island .desktop-omni-btn-play {
            width: 40px;
            height: 40px;
            min-width: 40px;
            min-height: 40px;
            flex-shrink: 0;
        }
        .song-card { transition: opacity 0.2s, transform 0.2s, border-color 0.2s; }
        .song-card-body { transition: opacity 0.2s; }
        /* Desktop Spotify-style: play overlay on cover (hover), selection highlight */
        .desktop-play-overlay { z-index: 2; transition: opacity 0.25s ease-out; }
        /* While this track is playing, hide the hover play overlay so the playing icon shows instead */
        #desktop-app .is-currently-playing .desktop-play-overlay { opacity: 0 !important; pointer-events: none; }
        /* Playing indicator: no breathing animation; fade in when playing, fade out when stopped */
        #desktop-app .active-indicator-container .playing-icon { animation: none !important; }
        #desktop-app .active-indicator-container { transition: opacity 0.25s ease-out; }
        .song-row.selected, .playlist-track-row.selected { box-shadow: inset 0 0 0 2px var(--accent); }
        .song-card.selected { box-shadow: 0 0 0 2px var(--accent); }
        .queue-item.selected { box-shadow: inset 0 0 0 2px var(--accent); }
        /* Playlist track reorder drag */
        .playlist-drag-clone { position: fixed; z-index: 200; pointer-events: none; border-radius: 1rem; box-shadow: var(--shadow-omni); border: 1px solid var(--glass-border); }
        .playlist-track-row.playlist-drag-source { opacity: 0.2; pointer-events: none; }
        .playlist-track-row.queue-drop-target { outline: 2px solid var(--accent); outline-offset: 2px; border-radius: 1rem; }
        .playlist-card.playlist-drag-source { opacity: 0.2; pointer-events: none; }
        .playlist-card.queue-drop-target { outline: 2px solid var(--accent); outline-offset: 2px; border-radius: 1rem; }
        /* Desktop queue panel: inside sidebar, no border, no windowâ€”just songs on sidebar background */
        #desktop-queue-panel { flex-shrink: 0; background: transparent; border: none; box-sizing: border-box; }
        #desktop-queue-panel .queue-item { border: none; width: 100%; min-width: 0; box-sizing: border-box; }
        #desktop-queue-panel .queue-item:hover { background: var(--surface-overlay); }
        #desktop-queue-panel .queue-item.queue-item-second { opacity: 0.6; }
        #desktop-queue-panel::-webkit-scrollbar { width: 6px; }
        #desktop-queue-panel::-webkit-scrollbar-thumb { background: var(--text-dim); border-radius: 3px; opacity: 0.4; }
        #desktop-downloads-panel { background: transparent; border: none; box-sizing: border-box; }
        #desktop-downloads-panel::-webkit-scrollbar { width: 6px; }
        #desktop-downloads-panel::-webkit-scrollbar-thumb { background: var(--text-dim); border-radius: 3px; opacity: 0.4; }
        @keyframes dl-progress-indeterminate { 0% { transform: translateX(-100%); } 100% { transform: translateX(350%); } }
        /* Queue row handle: visible on hover, no highlight on hover/focus/active */
        .queue-item-handle-wrap { opacity: 0; transition: opacity 0.2s; }
        .group:hover .queue-item-handle-wrap { opacity: 1; }
        .queue-item-handle { cursor: grab; }
        .queue-item-handle:hover,
        .queue-item-handle:focus,
        .queue-item-handle:active { background: transparent !important; outline: none; box-shadow: none; }
        .queue-item-handle:active { cursor: grabbing; }
        .queue-move-btn:focus { outline: none; }
        /* Desktop queue reorder drag */
        .queue-drag-clone { position: fixed; z-index: 200; pointer-events: none; border-radius: var(--radius-omni-xs); box-shadow: var(--shadow-omni); border: 1px solid var(--glass-border); background: var(--bg-surface); }
        .queue-item.queue-drop-target { outline: 2px solid var(--accent); outline-offset: 2px; border-radius: var(--radius-omni-xs); }
        .queue-item.queue-drag-source { opacity: 0.2; pointer-events: none; }
        /* Discover: grid layout, no horizontal scroll */
        .discover-section { margin-bottom: 1.5rem; flex-shrink: 0; }
        .discover-section h2 { font-size: 0.625rem; font-weight: 800; letter-spacing: 0.3em; text-transform: uppercase; color: var(--accent); margin-bottom: 0.75rem; }
        .discover-shelf { display: grid; grid-template-columns: repeat(auto-fill, minmax(min(100%, 280px), 1fr)); gap: 0.75rem; }
        .discover-card { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-radius: 1rem; background: var(--surface-overlay); border: 1px solid var(--glass-border); transition: background 0.2s, border-color 0.2s; min-width: 0; }
        .discover-card:hover { background: var(--bg-card); }
        .discover-card-cover { width: 48px; height: 48px; flex-shrink: 0; border-radius: 0.75rem; background-size: cover; background-position: center; background-color: var(--input-bg); }
        .discover-card-meta { flex: 1; min-width: 0; }
        .discover-card-title { font-size: 0.8125rem; font-weight: 600; color: var(--text-main); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .discover-card-artist { font-size: 0.625rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-dim); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .discover-skeleton { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-radius: 1rem; background: var(--surface-overlay); border: 1px solid var(--glass-border); min-width: 0; }
        .discover-skeleton-cover { width: 48px; height: 48px; flex-shrink: 0; border-radius: 0.75rem; background: var(--input-bg); }
        .discover-skeleton-text { flex: 1; min-width: 0; }
        .discover-skeleton-line { height: 12px; border-radius: 4px; background: var(--text-dim); opacity: 0.3; margin-bottom: 6px; }
        .discover-skeleton-line:last-child { width: 60%; margin-bottom: 0; }
        @keyframes discover-shimmer { 0% { opacity: 0.3; } 50% { opacity: 0.5; } 100% { opacity: 0.3; } }
        .discover-skeleton-cover { animation: discover-shimmer 1.5s ease-in-out infinite; }
        .discover-skeleton-line { animation: discover-shimmer 1.5s ease-in-out infinite; }
        @media (prefers-reduced-motion: reduce) { .discover-skeleton-cover, .discover-skeleton-line { animation: none; } }
        @keyframes song-marquee {
            0%, 15% { transform: translateX(0); }
            85%, 100% { transform: translateX(var(--marquee-offset, -100%)); }
        }
        .artist-marquee .song-card-artist-text { animation: song-marquee 8s linear infinite; }
        @media (prefers-reduced-motion: reduce) {
            .artist-marquee .song-card-artist-text { animation: none; }
            .artist-marquee { overflow: hidden; text-overflow: ellipsis; }
            #desktop-now-playing .desktop-np-timebar-row { transition: none; }
        }
        /* Right-click context menu: compact glass panel, theme-aware */
        #desktop-context-menu {
            position: fixed;
            z-index: 260;
            min-width: 180px;
            padding: 6px 0;
            background: var(--bg-surface);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-omni-xs);
            box-shadow: var(--shadow-omni);
        }
        #desktop-context-menu .desktop-context-item {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 8px 14px;
            border: none;
            background: transparent;
            color: var(--text-main);
            font-size: 0.875rem;
            font-weight: 700;
            text-align: left;
            cursor: pointer;
            transition: background 0.2s;
        }
        #desktop-context-menu .desktop-context-item:hover { background: var(--surface-overlay); }
        #desktop-context-menu .desktop-context-item i { width: 1rem; flex-shrink: 0; }
        #desktop-context-menu .desktop-context-item.delete-item { color: rgb(248 113 113); }
        #desktop-context-menu .desktop-context-item.delete-item:hover { background: rgba(239 68 68 / 0.1); }
    </style>
    <script>
        (function() {
            try {
                var raw = localStorage.getItem('soundsible_theme');
                if (raw) {
                    var theme = (typeof raw === 'string' && raw !== '') ? (function() { try { return JSON.parse(raw); } catch(e) { return null; } })() : null;
                    if (theme && ['dark','light','odst'].indexOf(theme) !== -1) {
                        document.documentElement.setAttribute('data-theme', theme);
                        var meta = document.getElementById('meta-theme-color');
                        if (meta) meta.setAttribute('content', theme === 'light' ? '#f5f5f5' : theme === 'odst' ? '#1c2026' : '#0d0d0f');
                    }
                }
            } catch (e) {}
        })();
    </script>
</head>
<body>
    <div id="initial-loader" class="fixed inset-0 z-[1000] flex flex-col items-center justify-center transition-opacity duration-700 initial-loader-bg">
        <div class="relative w-24 h-24 mb-8">
            <div class="absolute inset-0 border-4 border-[var(--accent)]/10 rounded-full"></div>
            <div class="absolute inset-0 border-4 border-t-[var(--accent)] rounded-full animate-spin"></div>
            <img src="assets/icons/logo-mark.svg" class="absolute inset-4 w-16 h-16 opacity-60" alt="Logo">
        </div>
        <div class="text-[10px] font-black uppercase tracking-[0.4em] text-[var(--accent)] animate-pulse">Initializing</div>
    </div>

    <div id="desktop-app" class="hidden">
            <div id="desktop-body">
            <div id="desktop-now-playing" class="glass-view">
                <div class="desktop-np-left-cell flex items-center gap-3 min-w-0">
                    <div class="desktop-np-left">
                        <div class="desktop-np-cover-wrap flex items-center">
                            <div id="desktop-np-cover" class="w-14 h-14 rounded-xl bg-cover bg-center flex-shrink-0 border border-[var(--glass-border)] cursor-pointer bg-[var(--bg-card)]"></div>
                        </div>
                        <div class="desktop-np-center flex flex-col gap-1.5 items-stretch justify-center min-h-0">
                            <div id="desktop-np-title" class="font-bold text-sm truncate text-[var(--text-main)]"></div>
                            <div id="desktop-np-artist" class="text-xs text-[var(--text-dim)] truncate"></div>
                        </div>
                    </div>
                </div>
                <div class="desktop-np-playback-cell">
                    <div id="desktop-omni-island">
                        <button type="button" id="desktop-omni-prev" class="desktop-omni-btn-side flex items-center justify-center rounded-full hover:bg-[var(--surface-overlay)] text-[var(--text-main)] transition-colors" aria-label="Previous"><i class="fas fa-backward-step text-xs"></i></button>
                        <button type="button" id="desktop-omni-play" class="desktop-omni-btn-play flex items-center justify-center rounded-full bg-[var(--accent)] text-[var(--text-on-accent)] hover:opacity-90 transition-opacity" aria-label="Play"><i id="desktop-omni-play-icon" class="fas fa-play text-sm"></i></button>
                        <button type="button" id="desktop-omni-next" class="desktop-omni-btn-side flex items-center justify-center rounded-full hover:bg-[var(--surface-overlay)] text-[var(--text-main)] transition-colors" aria-label="Next"><i class="fas fa-forward-step text-xs"></i></button>
                    </div>
                </div>
                <div id="desktop-np-bubbles" class="desktop-np-right-cell flex items-center justify-end gap-2 flex-shrink-0">
                    <div class="desktop-volume-bubble-wrap">
                        <div id="desktop-volume-bubble" class="desktop-np-bubble glass-view flex items-center pl-0 pr-1.5 flex-row-reverse">
                            <button type="button" id="desktop-volume-mute-btn" class="desktop-volume-icon-wrap flex items-center justify-center w-8 h-8 min-w-[32px] min-h-[32px] flex-shrink-0 text-[var(--text-dim)] hover:bg-[var(--surface-overlay)] rounded-full transition-colors focus:outline-none" aria-label="Mute">
                                <i id="desktop-volume-icon" class="fas fa-volume-high text-xs" aria-hidden="true"></i>
                            </button>
                            <input type="range" id="desktop-volume" class="h-1.5 flex-1 min-w-0 rounded-full accent-[var(--accent)]" min="0" max="100" value="100" style="background: var(--seek-track);" aria-label="Volume" />
                        </div>
                    </div>
                    <div class="desktop-np-bubble glass-view flex items-center justify-center rounded-full w-8 h-8 min-w-[32px] min-h-[32px]">
                        <button type="button" id="desktop-shuffle-btn" class="w-full h-full flex items-center justify-center rounded-full text-[var(--text-dim)] hover:bg-[var(--surface-overlay)] transition-colors focus:outline-none" aria-label="Shuffle"><i class="fas fa-shuffle text-xs"></i></button>
                    </div>
                    <div class="desktop-np-bubble glass-view flex items-center justify-center rounded-full w-8 h-8 min-w-[32px] min-h-[32px] relative">
                        <button type="button" id="desktop-repeat-btn" class="w-full h-full flex items-center justify-center rounded-full text-[var(--text-dim)] hover:bg-[var(--surface-overlay)] transition-colors focus:outline-none relative" aria-label="Repeat"><i class="fas fa-repeat text-xs"></i><span id="desktop-repeat-one-indicator" class="absolute bottom-0 right-0 text-[7px] font-black text-[var(--accent)] hidden">1</span></button>
                    </div>
                </div>
                <div id="desktop-np-timebar-row" class="desktop-np-timebar-row">
                    <span id="desktop-np-time-current" class="desktop-np-time-label text-[12px] font-semibold font-mono text-[var(--text-dim)]">0:00</span>
                    <input type="range" id="desktop-np-seek" class="h-1.5 rounded-full accent-[var(--accent)] min-w-0" min="0" max="100" value="0" style="background: var(--seek-track);" />
                    <span id="desktop-np-time-duration" class="desktop-np-time-label text-[12px] font-semibold font-mono text-[var(--text-dim)] text-right">0:00</span>
                </div>
            </div>
            <div id="desktop-body-row">
            <aside id="desktop-sidebar" class="glass-view">
                <button type="button" class="desktop-nav-btn" data-view="discover"><i class="fas fa-globe mr-3 w-4"></i>Discover</button>
                <button type="button" class="desktop-nav-btn active" data-view="home"><i class="fas fa-box mr-3 w-4"></i>Library</button>
                <button type="button" class="desktop-nav-btn" data-view="favourites"><i class="fas fa-heart mr-3 w-4"></i>Favourites</button>
                <button type="button" class="desktop-nav-btn" data-view="playlists"><i class="fas fa-layer-group mr-3 w-4"></i>Playlists</button>
                <button type="button" class="desktop-nav-btn" data-view="artists"><i class="fas fa-user mr-3 w-4"></i>Artists</button>
                <button type="button" class="desktop-nav-btn" data-view="podcast"><i class="fas fa-podcast mr-3 w-4"></i>Podcasts</button>
                <button type="button" class="desktop-nav-btn" data-view="settings"><i class="fas fa-cog mr-3 w-4"></i>Settings</button>
                <div class="flex items-center justify-between w-full mt-2 gap-2 flex-shrink-0">
                    <button type="button" id="desktop-queue-btn" class="desktop-queue-status-btn flex items-center gap-2 px-3 py-2 rounded-[var(--radius-omni-xs)] hover:bg-[var(--surface-overlay)] text-[var(--text-dim)] hover:text-[var(--text-main)] font-semibold text-sm transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent)]" aria-label="Queue" aria-expanded="false">
                        <i class="fas fa-list-ul w-4"></i>
                        <span>Queue</span>
                        <span id="desktop-queue-count" class="opacity-70">0</span>
                    </button>
                    <button type="button" id="desktop-queue-clear-btn" class="text-[10px] font-bold uppercase tracking-wider text-[var(--text-dim)] hover:text-red-400 px-2 py-1 rounded transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent)]" aria-label="Clear queue">Clear</button>
                </div>
                <div id="desktop-queue-panel" class="hidden overflow-y-auto min-h-0" style="max-height: 40vh;">
                    <div id="desktop-queue-tracks" class="space-y-0 py-1"></div>
                </div>
                <div id="desktop-downloads-section" class="hidden flex-shrink-0 mt-2">
                    <div class="flex items-center justify-between w-full mb-1 px-1">
                        <span class="text-[10px] font-black uppercase tracking-widest text-[var(--text-dim)]">Downloads</span>
                    </div>
                    <div id="desktop-downloads-panel" class="overflow-y-auto min-h-0 space-y-0 py-1" style="max-height: 40vh;">
                        <div id="desktop-downloads-list" class="space-y-0"></div>
                    </div>
                </div>
                <div class="flex-1 min-h-0"></div>
                <div class="flex justify-center flex-shrink-0 pt-2">
                    <button type="button" id="desktop-logo-omni" class="logo-omni-seed desktop-logo-omni glass-view flex items-center justify-center overflow-hidden pointer-events-auto cursor-pointer border-none outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-deep)]" aria-label="Soundsible menu" title="Soundsible">
                        <img src="assets/icons/logo_sin_fondo.png" class="h-10 w-10 flex-shrink-0 object-contain pointer-events-none" alt="" aria-hidden="true">
                    </button>
                </div>
            </aside>

            <main id="desktop-main">
                <!-- Global Desktop Search -->
                <div id="desktop-global-search-container">
                    <div class="desktop-global-search-inner">
                        <i class="fas fa-search text-[var(--placeholder)] text-sm"></i>
                        <input type="text" id="desktop-global-search-input" placeholder="Search library..." autocomplete="off" spellcheck="false" />
                        <button id="desktop-global-search-clear" class="hidden text-[var(--placeholder)] hover:text-[var(--text-main)] transition-colors">
                            <i class="fas fa-times-circle"></i>
                        </button>
                        <div id="desktop-discover-odst-inline" class="desktop-discover-odst-inline flex gap-1.5 p-1 rounded-full border border-[var(--glass-border)] flex-shrink-0" style="background: var(--input-bg);">
                            <button type="button" id="search-odst-music" class="px-3 py-1.5 rounded-full text-[10px] font-bold transition-colors bg-[var(--accent)] text-[var(--text-on-accent)]" aria-pressed="true">Music</button>
                            <button type="button" id="search-odst-youtube" class="px-3 py-1.5 rounded-full text-[10px] font-bold transition-colors bg-[var(--accent)]/15 text-[var(--accent)]" aria-pressed="false">Youtube</button>
                        </div>
                    </div>
                </div>

                <div id="desktop-view-home" class="desktop-view active">
                    <div id="desktop-all-songs" class="space-y-2 mt-4"></div>
                </div>
                <div id="desktop-view-favourites" class="desktop-view">
                    <div id="desktop-fav-tracks" class="space-y-2 mt-4"></div>
                </div>
                <div id="desktop-view-artists" class="desktop-view">
                    <div id="desktop-all-artists" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6"></div>
                </div>
                <div id="desktop-view-artist-detail" class="desktop-view">
                    <button type="button" id="desktop-artist-back" class="flex items-center text-[var(--secondary)] font-bold mb-8 hover:underline">
                        <i class="fas fa-chevron-left mr-2"></i>Back
                    </button>
                    <div id="desktop-artist-hero" class="flex flex-col sm:flex-row items-center sm:items-end gap-6 mb-10">
                        <div id="desktop-artist-detail-cover" class="w-32 h-32 sm:w-40 sm:h-40 rounded-[var(--radius-omni-sm)] shadow-2xl bg-cover bg-center border border-[var(--glass-border)] bg-[var(--bg-card)] flex-shrink-0"></div>
                        <h1 id="desktop-artist-detail-title" class="text-4xl md:text-6xl font-black tracking-tighter leading-none text-center sm:text-left">Artist</h1>
                    </div>
                    <section class="mb-10">
                        <h2 class="text-[10px] font-black text-[var(--text-dim)] uppercase tracking-widest mb-4">All tracks</h2>
                        <div id="desktop-artist-tracks" class="space-y-2"></div>
                    </section>
                    <section>
                        <h2 class="text-[10px] font-black text-[var(--text-dim)] uppercase tracking-widest mb-4">Albums</h2>
                        <div id="desktop-artist-albums" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6"></div>
                    </section>
                </div>
                <div id="desktop-view-playlists" class="desktop-view flex flex-col min-h-[60vh]">
                    <div id="desktop-playlist-empty-state" class="flex-1 flex flex-col items-center justify-center text-center min-h-[min(70vh,600px)]">
                        <i class="fas fa-layer-group text-4xl text-[var(--text-dim)]/50 mb-4"></i>
                        <p class="text-[var(--text-dim)] font-bold text-sm uppercase tracking-widest mb-2">No playlists yet</p>
                        <p class="text-[var(--text-dim)] text-xs mb-6">Create one or add tracks from Library.</p>
                        <button type="button" id="desktop-playlist-create-btn" class="desktop-create-playlist-btn min-h-[44px] px-6 py-3 rounded-xl bg-[var(--accent)] text-[var(--text-on-accent)] font-bold text-sm transition-all hover:opacity-90 focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent)]" onclick="typeof createPlaylistPrompt==='function'&&createPlaylistPrompt()"><i class="fas fa-plus mr-2"></i>Create playlist</button>
                    </div>
                    <div id="desktop-playlist-has-list" class="hidden flex flex-col flex-1">
                        <div class="flex justify-center mb-4 flex-shrink-0">
                            <button type="button" id="desktop-playlist-create-btn-has" class="desktop-create-playlist-btn min-h-[44px] px-6 py-3 rounded-xl bg-[var(--accent)] text-[var(--text-on-accent)] font-bold text-sm transition-all hover:opacity-90 focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent)]" onclick="typeof createPlaylistPrompt==='function'&&createPlaylistPrompt()"><i class="fas fa-plus mr-2"></i>Create playlist</button>
                        </div>
                        <div id="desktop-playlist-list-container" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 content-start"></div>
                    </div>
                </div>
                <div id="desktop-view-playlist-detail" class="desktop-view">
                    <button type="button" id="desktop-playlist-detail-back" class="flex items-center text-[var(--secondary)] font-bold mb-8 hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent)]" onclick="typeof DesktopUI!=='undefined'&&DesktopUI.navigateBack&&DesktopUI.navigateBack()">
                        <i class="fas fa-chevron-left mr-2"></i>Back
                    </button>
                    <div id="desktop-playlist-detail-hero" class="flex flex-col sm:flex-row items-center sm:items-end gap-6 mb-10">
                        <div id="desktop-playlist-detail-cover" class="w-32 h-32 sm:w-40 sm:h-40 rounded-[var(--radius-omni-sm)] shadow-2xl bg-cover bg-center border border-[var(--glass-border)] bg-[var(--bg-card)] flex-shrink-0 flex items-center justify-center">
                            <i class="fas fa-layer-group text-4xl text-[var(--text-dim)]/40 hidden" id="desktop-playlist-detail-cover-icon"></i>
                        </div>
                        <div class="flex-1 min-w-0 text-center sm:text-left">
                            <h1 id="desktop-playlist-detail-title" class="text-2xl sm:text-4xl font-black tracking-tighter leading-none text-[var(--text-main)] truncate">Playlist</h1>
                            <p id="desktop-playlist-detail-meta" class="text-[var(--text-dim)] text-sm mt-1 font-mono">0 tracks</p>
                            <div class="flex flex-wrap gap-2 mt-3 justify-center sm:justify-start">
                                <button type="button" id="desktop-playlist-detail-rename-btn" class="px-3 py-1.5 rounded-lg bg-[var(--surface-overlay)] text-[var(--text-main)] text-xs font-bold hover:opacity-90 transition-opacity focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent)]" onclick="typeof renamePlaylistPrompt==='function'&&renamePlaylistPrompt()">Rename</button>
                                <button type="button" id="desktop-playlist-detail-duplicate-btn" class="px-3 py-1.5 rounded-lg bg-[var(--surface-overlay)] text-[var(--text-main)] text-xs font-bold hover:opacity-90 transition-opacity focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent)]" onclick="typeof duplicatePlaylistPrompt==='function'&&duplicatePlaylistPrompt()">Duplicate</button>
                                <button type="button" id="desktop-playlist-detail-delete-btn" class="px-3 py-1.5 rounded-lg bg-red-500/15 text-red-400 text-xs font-bold hover:bg-red-500/25 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-red-400" onclick="typeof deletePlaylistConfirm==='function'&&deletePlaylistConfirm()">Delete</button>
                            </div>
                        </div>
                    </div>
                    <div id="desktop-playlist-detail-tracks" class="space-y-2"></div>
                </div>
                <!-- YouTube preview modal (ODST result click from Search) -->
                <div id="dl-preview-modal" class="fixed inset-0 z-[110] hidden flex-col backdrop-blur-sm" style="background-color: var(--overlay-bg);">
                    <div class="flex-1 flex items-center justify-center p-4 flex-col">
                        <div class="relative w-full max-w-2xl">
                            <div id="dl-preview-iframe-wrap" class="w-full aspect-video rounded-xl overflow-hidden bg-black"></div>
                            <button type="button" id="dl-preview-close" class="absolute top-3 right-3 z-10 w-12 h-12 flex items-center justify-center rounded-full bg-[var(--surface-overlay)] text-[var(--text-main)] shadow-lg hover:bg-black/40 transition-colors" aria-label="Close"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="flex justify-center pt-3">
                            <button type="button" id="dl-preview-add-to-queue" class="w-12 h-12 rounded-full bg-[var(--surface-overlay)] hover:bg-[var(--accent)] text-[var(--text-main)] flex items-center justify-center transition-all hidden" aria-label="Add to download queue"><i class="fas fa-cloud-download-alt text-sm"></i></button>
                        </div>
                    </div>
                </div>
                <!-- Cover choice modal (when premium cover fails) -->
                <div id="dl-cover-choice-modal" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-4 backdrop-blur-[9.6px]" style="background-color: var(--overlay-bg);">
                    <div class="glass-view rounded-[var(--radius-omni)] w-full max-w-md p-8 border border-[var(--glass-border)] shadow-2xl">
                        <h3 class="text-xl font-bold mb-2 text-[var(--text-main)]">No Premium Cover Found</h3>
                        <p class="text-sm text-[var(--text-dim)] mb-6">Choose how to handle the cover art for this track:</p>
                        <div id="dl-cover-choice-track-info" class="mb-6 p-4 rounded-lg" style="background-color: var(--input-bg);">
                            <div class="text-sm font-bold" id="dl-cover-choice-title"></div>
                            <div class="text-xs text-[var(--text-dim)] mt-1" id="dl-cover-choice-artist"></div>
                        </div>
                        <div class="space-y-3">
                            <button id="dl-cover-choice-yt" class="w-full flex items-center space-x-3 p-4 bg-[var(--surface-overlay)] hover:opacity-80 rounded-lg transition-colors text-left">
                                <i class="fas fa-image text-[var(--accent)]"></i>
                                <div>
                                    <div class="font-bold text-sm text-[var(--text-main)]">Use YouTube Cover</div>
                                    <div class="text-xs text-[var(--text-dim)]">Use the YouTube thumbnail</div>
                                </div>
                            </button>
                            <button id="dl-cover-choice-library" class="w-full flex items-center space-x-3 p-4 bg-[var(--surface-overlay)] hover:opacity-80 rounded-lg transition-colors text-left">
                                <i class="fas fa-folder-open text-purple-400"></i>
                                <div>
                                    <div class="font-bold text-sm text-[var(--text-main)]">Choose from Library</div>
                                    <div class="text-xs text-[var(--text-dim)]">Use cover from another song</div>
                                </div>
                            </button>
                            <button id="dl-cover-choice-upload" class="w-full flex items-center space-x-3 p-4 bg-[var(--surface-overlay)] hover:opacity-80 rounded-lg transition-colors text-left">
                                <i class="fas fa-upload text-blue-400"></i>
                                <div>
                                    <div class="font-bold text-sm text-[var(--text-main)]">Upload File</div>
                                    <div class="text-xs text-[var(--text-dim)]">Upload your own cover image</div>
                                </div>
                            </button>
                            <button id="dl-cover-choice-none" class="w-full flex items-center space-x-3 p-4 bg-[var(--surface-overlay)] hover:opacity-80 rounded-lg transition-colors text-left">
                                <i class="fas fa-ban text-[var(--text-dim)]"></i>
                                <div>
                                    <div class="font-bold text-sm text-[var(--text-main)]">No Cover</div>
                                    <div class="text-xs text-[var(--text-dim)]">Leave without cover art</div>
                                </div>
                            </button>
                        </div>
                        <button id="dl-cover-choice-close" class="w-full mt-6 py-3 text-[var(--text-dim)] font-bold hover:text-[var(--text-main)] transition-colors">Cancel</button>
                    </div>
                </div>
                <!-- Download queue FAB + popover (Search view, no progress ring on desktop) -->
                <div id="desktop-dl-queue-container" class="fixed top-[max(1.5rem,env(safe-area-inset-top))] right-6 z-[120] flex flex-col items-end pointer-events-none hidden">
                    <button id="desktop-dl-queue-fab" type="button" class="w-12 h-12 bg-[var(--text-main)] text-[var(--bg-deep)] rounded-full shadow-2xl flex items-center justify-center transform scale-0 opacity-0 transition-all duration-500 hover:scale-105 active:scale-90 pointer-events-auto border-2 border-[var(--glass-border)] relative">
                        <i class="fas fa-list-ul"></i>
                        <div id="desktop-dl-queue-badge" class="absolute -top-1 -right-1 bg-[var(--accent)] text-[var(--text-on-accent)] text-[9px] font-black w-5 h-5 rounded-full flex items-center justify-center border border-[var(--glass-border)]">0</div>
                    </button>
                    <div id="desktop-dl-download-queue-popover" class="mt-4 w-72 glass-view rounded-[var(--radius-omni)] border border-[var(--glass-border)] shadow-2xl transform scale-95 opacity-0 pointer-events-none origin-top-right hidden transition-all duration-300" style="box-shadow: var(--shadow-omni);">
                        <div class="p-5">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-[10px] font-black uppercase tracking-widest text-[var(--text-dim)]">Download queue</h3>
                                <button type="button" id="desktop-dl-clear-queue-btn" class="text-[9px] font-black uppercase tracking-widest bg-red-500/10 text-red-400 px-3 py-1 rounded-full hover:bg-red-500/20 transition-colors">Clear</button>
                                <button type="button" id="desktop-dl-submit-download-btn" class="w-9 h-9 rounded-full bg-[var(--accent)] text-[var(--text-on-accent)] flex items-center justify-center shadow-lg hover:opacity-90 active:scale-90 pointer-events-auto transition-all duration-300" aria-label="Start download"><i class="fas fa-download text-xs"></i></button>
                            </div>
                            <div id="desktop-dl-download-queue-list" class="space-y-2 max-h-80 overflow-y-auto custom-scrollbar"></div>
                        </div>
                    </div>
                </div>
                <div id="desktop-view-podcast" class="desktop-view">
                    <div class="flex flex-col h-full w-full overflow-hidden p-6">
                        <h1 class="text-[10px] font-black uppercase tracking-[0.3em] text-[var(--accent)]">Podcasts</h1>
                        <p class="text-sm text-[var(--text-dim)] mt-4">Listen to your podcasts.</p>
                    </div>
                </div>
                <div id="desktop-view-discover" class="desktop-view">
                    <div class="flex flex-col h-full w-full overflow-hidden p-6">
                        <div id="desktop-discover-search-results" class="hidden flex-1 min-h-0 overflow-y-auto custom-scrollbar space-y-2 min-h-[120px]"></div>
                        <div id="desktop-discover-content-panel" class="flex flex-col flex-1 min-h-0 w-full overflow-y-auto custom-scrollbar">
                            <p id="desktop-discover-empty-library" class="hidden text-sm text-[var(--text-dim)] py-4 px-1">Search and download a song in the bar above to get recommendations!</p>
                            <div id="desktop-discover-config-wrap" class="p-4 rounded-2xl border border-[var(--glass-border)] mb-4 flex-shrink-0" style="background: var(--surface-overlay);">
                                    <p class="text-[10px] font-semibold uppercase tracking-widest text-[var(--text-dim)] mb-2">Recommendations configuration</p>
                                    <p class="text-xs text-[var(--text-dim)] mb-2">Last.fm improves recommendations. <a id="desktop-discover-lastfm-link" href="https://www.last.fm/api/account/create" target="_blank" rel="noopener noreferrer" class="text-[var(--accent)] font-bold underline hover:no-underline">https://www.last.fm/api/account/create</a></p>
                                    <details class="mb-3 text-[11px] text-[var(--text-dim)]">
                                        <summary class="cursor-pointer font-semibold text-[var(--text-main)]">How to get your API key</summary>
                                        <ol class="mt-2 space-y-1.5 list-decimal list-inside">
                                            <li><strong>Register first.</strong> You need a Last.fm account. Sign up at <a href="https://www.last.fm/join" target="_blank" rel="noopener noreferrer" class="text-[var(--accent)] underline">last.fm/join</a> (free) if you donâ€™t have one.</li>
                                            <li>Open the link above and create an application. Use: <strong>Contact email</strong> â€” your email; <strong>Application name</strong> â€” e.g. Soundsible; <strong>Application description</strong> â€” e.g. Music recommendations; <strong>Callback URL</strong> â€” leave blank or <code class="text-[10px] bg-[var(--input-bg)] px-1 rounded">https://localhost</code> (not used); <strong>Application homepage</strong> â€” leave blank or your site URL.</li>
                                            <li>After submitting, copy the <strong>API Key</strong> and paste it below.</li>
                                        </ol>
                                    </details>
                                    <div class="flex gap-2">
                                        <input type="password" id="desktop-discover-lastfm-input" class="input-theme flex-1 rounded-[var(--radius-omni-xs)] px-3 py-2 text-sm" placeholder="Last.fm API key" autocomplete="off">
                                        <button type="button" id="desktop-discover-lastfm-save" class="px-4 py-2 rounded-[var(--radius-omni-xs)] text-sm font-bold bg-[var(--accent)]/20 text-[var(--accent)] border border-[var(--accent)]/40 hover:opacity-90 transition-opacity">Save</button>
                                    </div>
                                    <p id="desktop-discover-lastfm-status" class="mt-2 text-xs text-[var(--text-dim)] hidden"></p>
                            </div>
                            <div id="desktop-discover-main" class="flex flex-col flex-1 min-h-0 hidden">
                                <div class="flex items-center justify-between gap-4 mb-4 flex-shrink-0">
                                    <h1 class="text-[10px] font-black uppercase tracking-[0.3em] text-[var(--accent)]">Discover</h1>
                                    <button type="button" id="desktop-discover-refresh-btn" class="px-4 py-2 rounded-xl text-sm font-semibold bg-[var(--surface-overlay)] hover:bg-[var(--accent)]/20 text-[var(--text-main)] hover:text-[var(--accent)] border border-[var(--glass-border)] transition-colors">Refresh</button>
                                </div>
                                <div id="desktop-discover-no-results" class="hidden text-center py-6 text-sm text-[var(--text-dim)]">No recommendations right now. Try again later.</div>
                                <div id="desktop-discover-sections" class="flex-1 min-h-0"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="desktop-view-settings" class="desktop-view">
                    <div class="glass-view rounded-2xl p-6 border border-[var(--glass-border)] max-w-xl space-y-6">
                        <h2 class="text-lg font-bold">Appearance</h2>
                        <div class="flex justify-between items-center gap-4">
                            <span class="text-sm text-[var(--text-main)]">Theme</span>
                            <select id="desktop-settings-theme-select" class="input-theme rounded-[var(--radius-omni-xs)] px-4 py-2 text-sm font-medium min-w-[140px]" aria-label="Theme">
                                <option value="dark">Dark</option>
                                <option value="light">Light</option>
                                <option value="odst">ODST</option>
                            </select>
                        </div>
                        <div class="flex justify-between items-center gap-4">
                            <span class="text-sm text-[var(--text-main)]">App icon</span>
                            <select id="desktop-settings-app-icon-select" class="input-theme rounded-[var(--radius-omni-xs)] px-4 py-2 text-sm font-medium min-w-[140px]" aria-label="App icon">
                                <option value="default">Default</option>
                                <option value="alt">Secondary</option>
                            </select>
                        </div>
                        <h2 class="text-lg font-bold pt-4">Sync & connection</h2>
                        <textarea id="desktop-sync-token-input" rows="3" class="input-theme w-full rounded-[var(--radius-omni-xs)] px-4 py-3 text-sm font-mono text-[var(--secondary)]" placeholder="Paste sync token..."></textarea>
                        <button type="button" id="desktop-import-token-btn" class="w-full bg-[var(--secondary)] hover:opacity-90 text-[var(--text-on-accent)] font-bold py-3 rounded-[var(--radius-omni-xs)]">Import Token</button>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-[var(--text-dim)]">Status</span>
                            <span id="desktop-server-status" class="font-bold text-green-500">â€”</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-[var(--text-dim)]">Host</span>
                            <span id="desktop-active-host-display" class="font-mono text-xs text-[var(--secondary)]">â€”</span>
                        </div>
                        <h2 class="text-lg font-bold pt-4">Library order</h2>
                        <select id="desktop-settings-library-order" class="input-theme rounded-[var(--radius-omni-xs)] px-4 py-2 text-sm font-medium min-w-[140px]">
                            <option value="date_added">Date added</option>
                            <option value="alphabetical">Alphabetical</option>
                            <option value="favorites_first">Favorites first</option>
                        </select>
                        <h2 class="text-lg font-bold pt-4">Recommendations</h2>
                        <p class="text-xs text-[var(--text-dim)] mb-2">Last.fm API key improves Discover. <a href="https://www.last.fm/api/account/create" target="_blank" rel="noopener noreferrer" class="text-[var(--accent)] font-bold underline hover:no-underline">https://www.last.fm/api/account/create</a></p>
                        <details class="mb-3 text-[11px] text-[var(--text-dim)]">
                            <summary class="cursor-pointer font-semibold text-[var(--text-main)]">How to get your API key</summary>
                            <ol class="mt-2 space-y-1.5 list-decimal list-inside">
                                <li><strong>Register first.</strong> You need a Last.fm account. Sign up at <a href="https://www.last.fm/join" target="_blank" rel="noopener noreferrer" class="text-[var(--accent)] underline">last.fm/join</a> (free) if you donâ€™t have one.</li>
                                <li>Open the link above and create an application. Use: <strong>Contact email</strong> â€” your email; <strong>Application name</strong> â€” e.g. Soundsible; <strong>Application description</strong> â€” e.g. Music recommendations; <strong>Callback URL</strong> â€” leave blank or <code class="text-[10px] bg-[var(--input-bg)] px-1 rounded">https://localhost</code> (not used); <strong>Application homepage</strong> â€” leave blank or your site URL.</li>
                                <li>After submitting, copy the <strong>API Key</strong> and paste it below.</li>
                            </ol>
                        </details>
                        <div class="flex gap-2">
                            <input type="password" id="desktop-settings-lastfm-api-key" class="input-theme flex-1 rounded-[var(--radius-omni-xs)] px-4 py-2 text-sm" placeholder="Last.fm API key" autocomplete="off">
                            <button type="button" id="desktop-settings-lastfm-save" class="px-4 py-2 rounded-[var(--radius-omni-xs)] text-sm font-bold bg-[var(--accent)]/20 text-[var(--accent)] border border-[var(--accent)]/40 hover:opacity-90 transition-opacity">Save</button>
                        </div>
                        <p id="desktop-settings-lastfm-status" class="mt-2 text-xs text-[var(--text-dim)] hidden"></p>
                        <h2 class="text-lg font-bold pt-4">Excluded from recommendation seeds</h2>
                        <p class="text-xs text-[var(--text-dim)] mb-2">Tracks in this list are not used to generate Discover recommendations.</p>
                        <div class="flex gap-2 mb-2">
                            <select id="desktop-settings-exclusions-add" class="input-theme flex-1 rounded-[var(--radius-omni-xs)] px-4 py-2 text-sm font-medium min-w-0" aria-label="Add track to exclusions">
                                <option value="">Choose a trackâ€¦</option>
                            </select>
                            <button type="button" id="desktop-settings-exclusions-add-btn" class="px-4 py-2 rounded-[var(--radius-omni-xs)] text-sm font-bold bg-[var(--accent)]/20 text-[var(--accent)] border border-[var(--accent)]/40 hover:opacity-90 transition-opacity flex-shrink-0">Add</button>
                        </div>
                        <ul id="desktop-settings-exclusions-list" class="space-y-2 max-h-48 overflow-y-auto custom-scrollbar text-sm"></ul>
                        <p id="desktop-settings-exclusions-status" class="mt-2 text-xs text-[var(--text-dim)] hidden"></p>
                        <h2 class="text-lg font-bold pt-4">Metadata</h2>
                        <button type="button" id="desktop-refetch-metadata-btn" class="w-full bg-[var(--secondary)] hover:opacity-90 text-[var(--text-on-accent)] font-bold py-3 rounded-[var(--radius-omni-xs)]">Re-fetch Metadata</button>
                        <div id="desktop-refetch-metadata-status" class="mt-2 text-xs text-[var(--text-dim)] hidden"></div>
                    </div>
                </div>
            </main>
            </div>
        </div>
    </div>

    <!-- Full-resolution cover overlay (Spotify-style) -->
    <div id="full-cover-overlay" class="fixed inset-0 z-[130] hidden flex items-center justify-center p-4 transition-opacity duration-300 ease-out" style="background-color: var(--overlay-bg);">
        <div id="full-cover-overlay-backdrop" class="absolute inset-0" aria-hidden="true"></div>
        <div id="full-cover-overlay-content" class="relative flex flex-col items-center max-w-[min(90vw,400px)] w-full" onclick="event.stopPropagation()">
            <div id="full-cover-image" class="w-full aspect-square max-w-[min(90vw,400px)] rounded-[var(--radius-omni)] bg-cover bg-center border border-[var(--glass-border)] shadow-[0_40px_80px_rgba(0,0,0,0.8)]" role="img" aria-label="Album art"></div>
            <button type="button" id="full-cover-close-bottom" class="mt-4 py-2.5 min-h-[44px] text-[var(--text-dim)] hover:text-[var(--text-main)] font-bold text-xs uppercase tracking-widest transition-colors focus:outline-none bg-transparent border-0" aria-label="Close">Close</button>
        </div>
    </div>

    <div id="toast-container" class="fixed bottom-24 left-1/2 -translate-x-1/2 z-[400] flex flex-col items-center gap-2 pointer-events-none max-w-xs"></div>

    <div id="desktop-context-menu" class="hidden" role="menu" aria-label="Track actions">
        <button type="button" id="desktop-context-queue" class="desktop-context-item" role="menuitem"><i class="fas fa-list-ul text-[var(--secondary)]"></i><span id="desktop-context-queue-text">Add to Queue</span></button>
        <button type="button" id="desktop-context-edit-metadata" class="desktop-context-item" role="menuitem"><i class="fas fa-pen-to-square text-purple-400"></i><span>Edit Metadata</span></button>
        <button type="button" id="desktop-context-fav" class="desktop-context-item" role="menuitem"><i class="fas fa-heart text-[var(--accent)]"></i><span id="desktop-context-fav-text">Add to Favourites</span></button>
        <button type="button" id="desktop-context-add-to-playlist" class="desktop-context-item" role="menuitem"><i class="fas fa-layer-group text-[var(--secondary)]"></i><span>Add to playlist</span></button>
        <button type="button" id="desktop-context-remove-from-playlist" class="desktop-context-item delete-item hidden" role="menuitem"><i class="fas fa-eject"></i><span>Remove from playlist</span></button>
        <button type="button" id="desktop-context-delete" class="desktop-context-item delete-item" role="menuitem"><i class="fas fa-trash-can"></i><span>Delete Track</span></button>
    </div>

    <div id="add-to-playlist-picker" class="fixed inset-0 z-[270] hidden flex items-center justify-center p-4" style="background-color: var(--overlay-bg);">
        <div id="add-to-playlist-picker-backdrop" class="absolute inset-0" style="backdrop-filter: blur(4px);"></div>
        <div class="add-to-playlist-picker-sheet glass-view rounded-2xl border border-[var(--glass-border)] shadow-2xl w-full max-w-sm overflow-hidden relative">
            <div class="p-4 border-b border-[var(--glass-border)]">
                <h3 class="text-sm font-black uppercase tracking-widest text-[var(--text-dim)]">Add to playlist</h3>
            </div>
            <div id="add-to-playlist-picker-list" class="max-h-64 overflow-y-auto p-2 space-y-1 custom-scrollbar"></div>
            <button type="button" id="add-to-playlist-picker-close" class="w-full p-3 text-sm font-bold text-[var(--text-dim)] hover:bg-[var(--surface-overlay)] transition-colors border-t border-[var(--glass-border)]">Cancel</button>
        </div>
    </div>

    <div id="desktop-action-menu" class="fixed inset-0 z-[250] hidden" style="background: var(--overlay-bg);">
        <div id="desktop-action-menu-overlay" class="absolute inset-0" style="backdrop-filter: blur(4px);"></div>
        <div id="desktop-action-menu-sheet" class="absolute bottom-0 left-0 right-0 max-w-md mx-auto rounded-t-2xl p-6 border-t border-[var(--glass-border)] glass-view">
            <div class="flex items-center gap-4 mb-4">
                <div id="desktop-action-track-art" class="w-16 h-16 rounded-xl bg-cover bg-center flex-shrink-0" style="background-image: url('assets/icons/icon-512.png');"></div>
                <div class="flex-1 min-w-0">
                    <div id="desktop-action-track-title" class="font-bold truncate text-[var(--text-main)]">â€”</div>
                    <div id="desktop-action-track-artist" class="text-sm text-[var(--text-dim)] truncate">â€”</div>
                </div>
            </div>
            <div class="space-y-1">
                <button type="button" id="desktop-action-queue" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-[var(--surface-overlay)] text-left font-bold text-sm text-[var(--text-main)]"><i class="fas fa-list-ul text-[var(--secondary)] w-4"></i><span id="desktop-action-queue-text">Add to Queue</span></button>
                <button type="button" id="desktop-action-edit-metadata" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-[var(--surface-overlay)] text-left font-bold text-sm text-[var(--text-main)]"><i class="fas fa-pen-to-square text-purple-400 w-4"></i><span>Edit Metadata</span></button>
                <button type="button" id="desktop-action-fav" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-[var(--surface-overlay)] text-left font-bold text-sm text-[var(--text-main)]"><i class="fas fa-heart text-[var(--accent)] w-4"></i><span id="desktop-action-fav-text">Favourite</span></button>
                <button type="button" id="desktop-action-add-to-playlist" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-[var(--surface-overlay)] text-left font-bold text-sm text-[var(--text-main)]"><i class="fas fa-layer-group text-[var(--secondary)] w-4"></i><span>Add to playlist</span></button>
                <button type="button" id="desktop-action-remove-from-playlist" class="hidden w-full flex items-center gap-4 p-3 rounded-xl hover:bg-red-500/10 text-red-400 text-left font-bold text-sm"><i class="fas fa-eject w-4"></i><span>Remove from playlist</span></button>
                <button type="button" id="desktop-action-delete" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-red-500/10 text-red-400 text-left font-bold text-sm"><i class="fas fa-trash-can w-4"></i><span>Delete Track</span></button>
            </div>
            <button type="button" id="desktop-action-close" class="w-full mt-4 py-3 text-[var(--text-dim)] font-bold hover:text-[var(--text-main)]">Close</button>
        </div>
    </div>

    <!-- Metadata Editor (same IDs as mobile for shared behaviour) -->
    <div id="metadata-editor" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-4 backdrop-blur-[9.6px] transition-all duration-150 ease-out" style="background-color: var(--overlay-bg);">
        <div id="metadata-editor-content" class="glass-view rounded-[var(--radius-omni)] w-full max-w-lg p-8 border border-[var(--glass-border)] shadow-2xl transition-all transform scale-95 opacity-0" style="box-shadow: var(--shadow-omni); transition-duration: 600ms; transition-timing-function: cubic-bezier(0.19, 1, 0.22, 1);">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-black tracking-tighter text-[var(--text-main)]">Edit Metadata</h2>
                <div class="text-[9px] font-black uppercase tracking-[0.2em] text-[var(--accent)] bg-[var(--accent)]/10 px-3 py-1 rounded-full border border-[var(--accent)]/20 font-mono">Surgical Mode</div>
            </div>
            <div class="space-y-6">
                <div class="flex flex-col items-center space-y-4">
                    <div class="relative group">
                        <img id="edit-cover-preview" src="assets/icons/icon-512.png" class="w-40 h-40 rounded-[var(--radius-omni-sm)] shadow-2xl object-cover border border-[var(--glass-border)]" alt="Art">
                        <div class="absolute inset-0 rounded-[var(--radius-omni-sm)] opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center pointer-events-none" style="background-color: var(--overlay-bg);">
                            <i class="fas fa-camera text-2xl text-[var(--text-main)]"></i>
                        </div>
                    </div>
                    <div class="flex space-x-3 w-full">
                        <button id="edit-auto-fetch-btn" class="flex-1 bg-[var(--surface-overlay)] active:opacity-80 py-3 rounded-[var(--radius-omni-xs)] text-xs font-bold transition-all focus:outline-none border border-[var(--input-border)] active:scale-95 text-[var(--text-main)]">
                            <i class="fas fa-magic mr-2 text-[var(--accent)]"></i>Auto-fetch
                        </button>
                        <button id="edit-upload-btn" class="flex-1 bg-[var(--surface-overlay)] active:opacity-80 py-3 rounded-[var(--radius-omni-xs)] text-xs font-bold transition-all focus:outline-none border border-[var(--input-border)] active:scale-95 text-[var(--text-main)]">
                            <i class="fas fa-upload mr-2 text-[var(--secondary)]"></i>Upload
                        </button>
                    </div>
                    <input type="file" id="edit-file-input" class="hidden" accept="image/*">
                </div>
                <div class="space-y-4">
                    <div class="group">
                        <label class="text-[10px] text-[var(--text-dim)] font-black uppercase tracking-widest mb-1.5 ml-1 block group-focus-within:text-[var(--accent)] transition-colors font-mono">Track Title</label>
                        <input type="text" id="edit-title" class="input-theme w-full rounded-[var(--radius-omni-xs)] px-5 py-4 text-sm focus:outline-none focus:border-[var(--accent)] transition-all font-medium text-[var(--text-main)]">
                    </div>
                    <div class="group">
                        <label class="text-[10px] text-[var(--text-dim)] font-black uppercase tracking-widest mb-1.5 ml-1 block group-focus-within:text-[var(--accent)] transition-colors font-mono">Artist Name</label>
                        <input type="text" id="edit-artist" class="input-theme w-full rounded-[var(--radius-omni-xs)] px-5 py-4 text-sm focus:outline-none focus:border-[var(--accent)] transition-all font-medium text-[var(--text-main)]">
                    </div>
                    <div class="group">
                        <label class="text-[10px] text-[var(--text-dim)] font-black uppercase tracking-widest mb-1.5 ml-1 block group-focus-within:text-[var(--accent)] transition-colors font-mono">Album Title</label>
                        <input type="text" id="edit-album" class="input-theme w-full rounded-[var(--radius-omni-xs)] px-5 py-4 text-sm focus:outline-none focus:border-[var(--accent)] transition-all font-medium text-[var(--text-main)]">
                    </div>
                </div>
                <div id="auto-fetch-results" class="hidden space-y-2 max-h-40 overflow-y-auto custom-scrollbar border-t border-[var(--glass-border)] pt-4"></div>
                <div id="edit-status" class="text-[10px] font-bold text-center min-h-[1rem] uppercase tracking-widest text-[var(--accent)] opacity-60 font-mono"></div>
                <div class="flex space-x-4 pt-4">
                    <button type="button" onclick="UI.hideMetadataEditor()" class="flex-1 py-4 text-[var(--text-dim)] font-black uppercase tracking-widest text-[10px] hover:text-[var(--text-main)] transition-colors focus:outline-none font-mono">Cancel</button>
                    <button type="button" id="edit-save-btn" class="flex-[2] bg-[var(--accent)] text-[var(--text-on-accent)] py-4 rounded-[var(--radius-omni-xs)] font-black uppercase tracking-widest text-xs shadow-lg shadow-[var(--accent)]/20 transition-all active:scale-95 active:brightness-110 focus:outline-none">
                        Save & Sync
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/app_desktop.js"></script>
</body>
</html>
